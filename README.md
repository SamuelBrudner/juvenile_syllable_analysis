# Overview of zebra finch syllable analysis

This folder contains code to analyze juvenile zebra finch syllable development after syllable spectrograms have been compressed using AVA (Goffinet et al., 2021). It uses both MATLAB and Python, including PyTorch and Ignite.

## Preprocessing and training
### initial_preprocess.m
requires an individual bird developmental dataset that has been processed using AVA and saved as Matlab table according to a convention in the file header. This script performs several preprocessing steps. Critically, it trains “predicted age networks” and calculates predicted age. It also writes training and evaluation datasets for developmental Gaussian models based on PyTorch.
### train_choleskyNet_periodic.py
should be run after “initial_preprocess.m”.  This script trains developmental Gaussian models for different syllables.
## Analysis
### score_predicted_age.py
calculates a MSE performance metric for the predicted age network. It calculates this metric for unshuffled data, as well as data shuffled according to a “total” and a “within-day” shuffling scheme.
### scoreGaussianPerformance.py
calculates the log likelihood performance metric for the gaussian model networks. It calculates this metric for unshuffled data, as well as data shuffled according to a “total” and a “within-day” shuffling scheme.
### write_sampled_model_timecourse.py
creates developmental trajectories by sampling the output of the trained Gaussian models during periods of robust singing. Note that these samples are distributions, not syllables or simulated syllables. For these samples along these trajectories, the script computes distribution entropy.
### real_data_quantile_split.py
reads predicted age information (written to text file during initial_preprocess.m). It bins renditions by age at production and calculates quantile performance scores in those bins. Then it calculates quantile-level overnight shifts and saves these to a pickled pandas table, and to a text file.
## Simulation
### write_simulated_syllables.py
takes times of real syllable renditions and ‘simulates’ syllables by (a) querying the Gaussian model at those times; (b) sampling from the distribution returned by each Gaussian model query.
### predAgeFromSimulation.m
takes the simulated syllables (generated in write_simulated_syllables.py) and uses the appropriate predicted age network (trained in “initial_preprocess.m”) to score the simulated syllables’ maturity.
### process_simulated_predicted_ages.py
 takes the age and predicted age values associated with simulated syllables (generated by write_simulated_syllables.py and predAgeFromSimulation.m) and calculates quantile-level overnight shifts in maturity for these simulations.
## Gaussian models
(See python_src)
### choleskyNet_periodic.py
defines the network class (CHOLESKY). Alternative architectures (shallower: CHOLESKY_LAYERS; fewer nodes/layer: CHOLESKY_64) are also defined in this file.
### devoDataset_periodic.py
defines the PyTorch dataset class used to train these network models.
## Predicted age network
(See matlab_src)
### nnRegressSyllable.m
defines the network used to predict age. An alternative, shallower architecture is defined in "nnRegressSyllable_fewerLayers.m”

## References
Goffinet, Brudner, Mooney, Pearson. Low-dimensional learned feature spaces quantify individual and group differences in vocal repertoires. eLife. 2021
